# NIP-99

## Prediction Markets

`draft` `optional` `author:ekzyis`

This NIP specifies how prediction markets can be implemented using nostr and lightning.

Any user ("the creator") can create a _predictable event_ (`kind 1099`) such that other users ("the participants") can buy and sell shares of possible outcomes using zap requests as defined by NIP-57 and reverse zap requests (TBD).
Services ("the betting exchanges") the required events for buying and selling shares, set the prices per share (based on odds) and handle payouts.
Participants can freely choose in which exchange(s) they want to participate, e.g. based on liquidity or reputation since participants must trust the exchanges with payouts and reporting the honest outcome of the event.
Exchanges can charge commissions on winning bets to incentivize continuous honest behaviour.

For a general overview on what prediction markets are, see Appendix A.

### Creation of predictable events

To create a predictable event, `kind 1099` events are used as defined by NIP-01 like this:

```json
{
  "content": <description about what should be predicted>,
  "tags": [
    ["outcome": <description of possible outcome>],
    ["outcome": <description of another possible outcome>],
    ...
  ],
  "kind": 1099,
  "id": <event_id>
  "pubkey": <pubkey of creator>,
  "created_at": <timestamp>,
  "sig": <signature>
}
```

Example for a binary option event:

```json
{
  "content": "Will Twitter go bankrupt in 2023?",
  "tags": [
    ["outcome": "Yes"],
    ["outcome": "No"]
  ],
  "kind": 1099,
  ...
}
```

Exchanges run clients which have subscribed to these events.
Per received event, they create parametrized replaceable events as defined by NIP-33 per possible outcome:

<!--
Working on a better explanation. Exchanges don't have to provide services for every event.

Also, I want to provide an example flow from start to finish.
This example flow should especially answer the following questions regarding "market bootstrapping":
  Q: How are initial prices set?
  A: Without any participants, there is no information regarding odds so every outcome is equally probable. So every share should cost the same.

  Q: What happens if there will only be one participant? Do they not always lose money because of potential commission fees?
  A: ???

  Q: Why would the first participant buy more than a single share? If they buy multiple shares, the next participant has an advantage because the next participant can just buy a single share to profit the most with the least risk (assuming no other participant will follow).
  Basically this: Why would you bet 100 sats to win 100 sats if you can just bet 1 sat to win 100 sats?
  A: ??? Maybe I am just confused with shares vs. odds. I need to learn more about prediction markets first.
-->

```json
{
  "content": <outcome description>,
  "tags": [
    ["e", <id of predictable event>],
    ["zap", <id of predictable event>+<outcome index>@SERVICE_URL, "lud16"]
    ["d", <id of predictable event>+<outcome index>]
    ["odds", <odds>, <odds format>]
  ],
  "kind": 301099,
  "id": <outcome event id>,
  "pubkey": <pubkey of bookmaker>,
  "created_at": <timestamp>
  ...
}
```

These events include `zap` tags to link zapping the event with buying a share of that specific outcome with the current given odds.

<!-- how to sell shares using NIP57 ??? -->

Outcomes are specified by using plus addresses and zero-based indexing the `outcome` tags in the referred predictable event. Participants must validate that the plus address local part references an outcome with the same description as in `content` to prevent ambiguity.

<!-- plus addresses are not supported by LUD16 ... yet? -->

The `odds` tag specifies the current odds for that outcome. The events are parametrized replaceable events with the `d` tag set to the plus address local part to replace the event with updated `<odds>` as soon as possible after each additional stake. `<odds>` are in the format specified by `<odds format>` which can take the values "fractional", "decimal" or "moneyline" (see Appendix B).

For example:

```json
{
  "content": "Yes",
  "tags": [
    ["e", <id of predictable event>],
    ["zap", <id of predictable event>+0@SERVICE_URL, "lud16"]
    ["d", <id of predictable event>+0]
    ["odds", "+148", "money line"]
  ],
  "kind": 301099,
  "created_at": 1683507135
  ...
}
```

To calculate `<odds>`, the probability $p(x)$ the market has chosen for the outcome $x$ is required. This is done by dividing the amount of stake on a specific outcome by the total amount of stake on the event: $p(x) = \frac{stake(x)}{\sum_i stake(i)}$
To make sure that there is always some stake to be won, a betting exchange can provide liquidity by betting on every outcome (like any other participant could).

<!--
I thought this would solve some bootstrapping issues if the betting exchange just bets on every outcome.
So participants know there is always something to win, regardless of participants order.
But not sure if this is a good approach??
-->

### Buying shares

Participants which want to bet on the outcome of an event zap the events created by the betting exchange to buy shares.

This means they create a Zap Request event request as specified in NIP-57 Appendix A with an `a` tag set (NIP-33 event coordinate).

### Selling shares

TBD

### Payouts

TBD

## Reference

### Appendix A

<!--
I think this video is a really good explanation of what I am trying to achieve with this NIP.
Is this "good style" to include links to videos instead of writing it out? -->

[![](https://img.youtube.com/vi/xA27x7GRMZQ/0.jpg)](https://www.youtube.com/watch?v=xA27x7GRMZQ)

### Appendix B

There are three main types of betting odds:

**Fractional**

Fractional odds show **how much you profit** should the bet succeed relative to the stake.
For example, if you bet 5 sats at odds 3/1, the potential profit is 3\*5=15 sats and the total returned is 15+5=20 sats.
Formula for potential profit: $odds \times stake$
Formula for probability of outcome: $\frac{1}{odds + 1}$, e.g. $\frac{1}{\frac{3}{1} + 1} = 0.25$

**Decimal**

Decimal odds show **how much is returned** should the bet succeed relative to the stake.
For example, if you bet 5 sats at odds 3, the total return is 5\*3=15 sats and thus the potential profit is 15-5=10 sats.
Formula for potential profit: $(odds - 1) \times stake$
Formula for probability $p$ of outcome: \frac{1}{odds}, e.g. $\frac{1}{\frac{3}{1}} = 0.33$

**Moneyline**

Moneyline odds can be positive or negative.
**Positive odds show how much is returned if you wager 100 sats**, e.g. odds of +300 mean that you can win 300 sats if you wager 100 sats.
**Negative odds show how much you need to wager to win 100 sats**, e.g. odds of -300 mean that you can win 100 sats if you wager 300 sats.
Formula for probability of outcome if positive: $\frac{100}{odds + 100}$, e.g. $\frac{100}{300+100} = 0.25$
Formula for probability of outcome if negative $\frac{abs(odds)}{abs(odds) + 100}$, e.g. $\frac{300}{300+100} = 0.75$
